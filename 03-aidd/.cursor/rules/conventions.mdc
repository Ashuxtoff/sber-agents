---
alwaysApply: true
---
# Правила разработки кода

> Правила для генерации кода, следуя принципам из `docs/vision.md`

## Общие принципы

1. **KISS/YAGNI** - простое решение > идеальное архитектурное решение
2. **Один файл** - вся логика в `bot.py`, разделена комментариями
3. **Минимум зависимостей** - только необходимое: aiogram, openai, python-dotenv
4. **Без абстракций** - никаких паттернов, слоев, middleware, репозиториев

## Структура bot.py

```python
# 1. Импорты
import ...
from ... import ...

# 2. Конфигурация
# Загрузка .env

# 3. Инициализация
# Создание bot и openai client

# 4. Хендлеры
# Обработка сообщений

# 5. Запуск
# Запуск polling
```

## Код

- **Простой и читаемый** - понятно с первого прочтения
- **Прямой вызов API** - без оберток, фабрик, прокси
- **Нет состояний** - stateless обработка, каждый запрос независим
- **Нет истории** - не храним предыдущие сообщения
- **Минимум проверок** - только критичные для работы

## Обработка ошибок

```python
# Простой try-except с логированием
try:
    response = llm_client.chat.completions.create(...)
except Exception as e:
    print(f"[ERROR] LLM error: {e}")
    await message.answer("Произошла ошибка")
```

**Без:**
- retry логики
- fallback механизмов
- детальной классификации ошибок
- context managers для обработки

## Логирование

```python
# Только print() с простым форматом
print(f"[START] Bot started")
print(f"[ERROR] {error_message}")
print(f"[INFO] User {user_id} sent message")
```

**Формат:** `[LEVEL] сообщение`
**Без:** библиотек логирования, уровней, фильтрации, JSON-форматирования

## Работа с данными

- **Только типы:** `str`, `dict`, `list`
- **Без:** dataclasses, pydantic, ORM, сериализации
- **Конфигурация из .env:** через `os.getenv()` или `python-dotenv`

## Вызовы API

- **Telegram:** aiogram с методом polling
- **LLM:** openai client с кастомным `base_url` для OpenRouter
- **Без:** таймаутов, rate limiting, кэширования, batching

## Критерии качества кода

✅ Хорошо:
- Простой, понятный код
- Один файл со всеми компонентами
- Минимум зависимостей
- Работает сразу после копирования

❌ Плохо:
- Множество файлов и слоев
- Абстракции без необходимости
- Избыточные проверки
- Паттерны проектирования
- Неиспользуемый код

